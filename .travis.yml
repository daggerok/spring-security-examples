service:
- docker
sudo: required
group: trusty_lts
env:
  global:
    TERM=dumb
language: java
jdk:
- openjdk8
- oraclejdk8
install: true
before_install:
- sudo apt update -y || true
# frontend tests
- export CHROME_BIN=/usr/bin/google-chrome
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- sudo apt install -y --no-install-recommends docker-ce python-pip curl jq libxml2-utils libappindicator1 fonts-liberation
- wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
- sudo dpkg -i google-chrome*.deb
- sudo pip install docker-compose httpie
# daggerok bash functions
- source <(curl -s https://raw.githubusercontent.com/daggerok/bash-functions/master/main.bash)
# kill whatever punning on postgres / rabbitmq port
- stop_any 5432 5672 27017
script:
- bash gradlew clean build docs
- export ROOT=$PWD
#
- cd ${ROOT}/spring-5-security-oauth2
- bash ./gradlew
- bash ./mvnw
#
- >
  for path in \
    keycloak-identity-management \
    csrf-protection-spa ;
  do
    export TARGET="$ROOT/$path"
    cd $TARGET
    bash gradlew clean assemble
    bash gradlew composeUp
    bash gradlew composeDown
  done;
